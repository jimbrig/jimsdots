'use strict';

var obsidian = require('obsidian');

/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/* global Reflect, Promise */

var extendStatics = function(d, b) {
    extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
    return extendStatics(d, b);
};

function __extends(d, b) {
    extendStatics(d, b);
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

var C__Users_HAOUARI_Desktop_Notes_NotesTest__obsidian_plugins_obsidianTextExtract_node_modules_removeMarkdown = function(md, options) {
  options = options || {};
  options.listUnicodeChar = options.hasOwnProperty('listUnicodeChar') ? options.listUnicodeChar : false;
  options.stripListLeaders = options.hasOwnProperty('stripListLeaders') ? options.stripListLeaders : true;
  options.gfm = options.hasOwnProperty('gfm') ? options.gfm : true;
  options.useImgAltText = options.hasOwnProperty('useImgAltText') ? options.useImgAltText : true;

  var output = md || '';

  // Remove horizontal rules (stripListHeaders conflict with this rule, which is why it has been moved to the top)
  output = output.replace(/^(-\s*?|\*\s*?|_\s*?){3,}\s*$/gm, '');

  try {
    if (options.stripListLeaders) {
      if (options.listUnicodeChar)
        output = output.replace(/^([\s\t]*)([\*\-\+]|\d+\.)\s+/gm, options.listUnicodeChar + ' $1');
      else
        output = output.replace(/^([\s\t]*)([\*\-\+]|\d+\.)\s+/gm, '$1');
    }
    if (options.gfm) {
      output = output
        // Header
        .replace(/\n={2,}/g, '\n')
        // Fenced codeblocks
        .replace(/~{3}.*\n/g, '')
        // Strikethrough
        .replace(/~~/g, '')
        // Fenced codeblocks
        .replace(/`{3}.*\n/g, '');
    }
    output = output
      // Remove HTML tags
      .replace(/<[^>]*>/g, '')
      // Remove setext-style headers
      .replace(/^[=\-]{2,}\s*$/g, '')
      // Remove footnotes?
      .replace(/\[\^.+?\](\: .*?$)?/g, '')
      .replace(/\s{0,2}\[.*?\]: .*?$/g, '')
      // Remove images
      .replace(/\!\[(.*?)\][\[\(].*?[\]\)]/g, options.useImgAltText ? '$1' : '')
      // Remove inline links
      .replace(/\[(.*?)\][\[\(].*?[\]\)]/g, '$1')
      // Remove blockquotes
      .replace(/^\s{0,3}>\s?/g, '')
      // Remove reference-style links?
      .replace(/^\s{1,2}\[(.*?)\]: (\S+)( ".*?")?\s*$/g, '')
      // Remove atx-style headers
      .replace(/^(\n)?\s{0,}#{1,6}\s+| {0,}(\n)?\s{0,}#{0,} {0,}(\n)?\s{0,}$/gm, '$1$2$3')
      // Remove emphasis (repeat the line to remove double emphasis)
      .replace(/([\*_]{1,3})(\S.*?\S{0,1})\1/g, '$2')
      .replace(/([\*_]{1,3})(\S.*?\S{0,1})\1/g, '$2')
      // Remove code blocks
      .replace(/(`{3,})(.*?)\1/gm, '$2')
      // Remove inline code
      .replace(/`(.+?)`/g, '$1')
      // Replace two or more newlines with exactly two? Not entirely sure this belongs here...
      .replace(/\n{2,}/g, '\n\n');
  } catch(e) {
    console.error(e);
    return md;
  }
  return output;
};

function inlineLog(str) {
    console.log(str);
    return str;
}
var SearchPP = /** @class */ (function (_super) {
    __extends(SearchPP, _super);
    function SearchPP() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.delay = 2000;
        _this.textExtraction = "Activated";
        _this.defaultSize = 30;
        return _this;
    }
    SearchPP.prototype.onload = function () {
        var _this = this;
        this.addSettingTab(new SettingTab(this.app, this));
        console.log('Loading insert search results plugin');
        var config = [
            {
                id: 'editor:insertSearchResultsFormated',
                name: 'Insert search results Formated',
                formatTitle: function (ele) { return "# " + ele.file.name + " (" + ele.result.content.length + ")" + "\n" + "[[" + ele.file.name + "]]" + "\n"; },
                formatResults: function (str, start, end) { return "## ..." + C__Users_HAOUARI_Desktop_Notes_NotesTest__obsidian_plugins_obsidianTextExtract_node_modules_removeMarkdown(str.substring(start, end).replace("\n", " ")) + "...\n"; },
                formatContent: function (str, start, end) { return C__Users_HAOUARI_Desktop_Notes_NotesTest__obsidian_plugins_obsidianTextExtract_node_modules_removeMarkdown(str.substring(start, end).replace("\n", " ")); },
                postResults: function () { _this.app.commands.commands["editor:fold-all"].checkCallback(); }
            },
            {
                id: 'editor:insertSearchResultsNotFormated',
                name: 'Insert search results not formated',
                formatTitle: function (ele) { return ele.file.name + " (" + ele.result.content.length + ")" + "\n" + "[[" + ele.file.name + "]]" + "\n"; },
                formatResults: function (str, start, end) { return C__Users_HAOUARI_Desktop_Notes_NotesTest__obsidian_plugins_obsidianTextExtract_node_modules_removeMarkdown(str.substring(start, end).replace("\n", " ")) + "...\n"; },
                formatContent: function (str, start, end) { return C__Users_HAOUARI_Desktop_Notes_NotesTest__obsidian_plugins_obsidianTextExtract_node_modules_removeMarkdown(str.substring(start, end).replace("\n", " ")); },
                postResults: function () { }
            },
            {
                id: 'editor:insertSearchResultContent',
                name: 'Insert search results content',
                formatTitle: function (ele) { return ""; },
                formatResults: function (str, start, end) { return ""; },
                formatContent: function (str, start, end) { return C__Users_HAOUARI_Desktop_Notes_NotesTest__obsidian_plugins_obsidianTextExtract_node_modules_removeMarkdown(str.substring(start, end).replace("\n", " ")); },
                postResults: function () { }
            }
        ];
        var reformatLinks = function (links, config, size) {
            var currentView = _this.app.workspace.activeLeaf.view;
            var query = _this.app.workspace.getLeavesOfType('search')[0].view.searchQuery.query.replace(/^"(.*)"$/, '$1');
            links.sort(function (a, b) { return b.result.content.length - a.result.content.length; });
            return links.filter(function (ele) { return ele.file.name !== currentView.file.name; }).map(function (ele) {
                var titleSize = 20;
                var extractedText = "";
                if (_this.textExtraction == "Activated") {
                    extractedText = config.formatTitle(ele);
                    var minIndex_1 = 9999999;
                    var maxIndex_1 = 0;
                    ele.result.content.forEach(function (position) {
                        var minTitle = Math.max(position[0] - titleSize, 0);
                        var maxTitle = Math.min(position[1] + titleSize, ele.content.length - 1);
                        var min = Math.max(position[0] - size, 0);
                        var max = Math.min(position[1] + size, ele.content.length - 1);
                        // console.log({min,max,minIndex,maxIndex})
                        if (!((min >= minIndex_1 && min <= maxIndex_1) || (max >= minIndex_1 && max <= maxIndex_1))) {
                            minIndex_1 = Math.min(minIndex_1, position[0]);
                            maxIndex_1 = Math.max(maxIndex_1, position[1]);
                            extractedText += config.formatResults(ele.content, minTitle, maxTitle);
                            //console.log(ele.content.substring(min,max));
                            extractedText += config.formatContent(ele.content, min, max);
                        }
                    });
                }
                return extractedText;
            }).join('\n');
        };
        function getLastLineNum(doc, line) {
            if (line === void 0) { line = 0; }
            var lineNum = line === 0
                ? doc.getCursor().line
                : line;
            if (doc.lineCount() === lineNum) {
                return doc.getCursor().line + 1;
            }
            return doc.getLine(lineNum) === '---'
                ? lineNum
                : getLastLineNum(doc, lineNum + 1);
        }
        var initExpander = function (config) {
            // Search files
            var cmDoc =  null;
            // @ts-ignore
            var globalSearchFn = _this.app.internalPlugins.getPluginById('global-search').instance.openGlobalSearch.bind(_this);
            var search = function (query) { return globalSearchFn(inlineLog(query)); };
            var getFoundFilenames = function (config, callback, size) {
                var searchLeaf = _this.app.workspace.getLeavesOfType('search')[0];
                console.log("searchLeaf", searchLeaf);
                searchLeaf.open(searchLeaf.view)
                    .then(function (view) { return setTimeout(function () {
                    // Using undocumented feature
                    // @ts-ignore
                    var result = reformatLinks(view.dom.resultDoms, config, size);
                    callback(result);
                    config.postResults();
                }, _this.delay); });
            };
            var currentView = _this.app.workspace.activeLeaf.view;
            if (currentView instanceof obsidian.MarkdownView) {
                cmDoc = currentView.sourceMode.cmEditor;
            }
            var hasFormulaRegexp = /^\{\{.+\}\}.*/;
            var curNum = cmDoc.getCursor().line;
            var curText = cmDoc.getLine(curNum);
            if (!hasFormulaRegexp.test(curText)) {
                return;
            }
            var isEmbed = cmDoc.getLine(curNum - 1) === '```expander'
                && cmDoc.getLine(curNum + 1) === '```';
            var fstLineNumToReplace = isEmbed
                ? curNum - 1
                : curNum;
            var lstLineNumToReplace = isEmbed
                ? getLastLineNum(cmDoc)
                : curNum;
            var searchQuery = curText.replace('{{', '').replace('}}', '');
            var size = _this.defaultSize;
            if (searchQuery.indexOf("/") !== -1) {
                size = +searchQuery.split("/")[1];
                searchQuery = searchQuery.split("/")[0];
            }
            var embedFormula = '```expander\n' +
                '{{' + searchQuery + '}}\n' +
                '```\n';
            var replaceLine = function (content) { return cmDoc.replaceRange(embedFormula + content + '\n\n', { line: fstLineNumToReplace, ch: 0 }, { line: lstLineNumToReplace, ch: cmDoc.getLine(lstLineNumToReplace).length }); };
            search(inlineLog(searchQuery));
            getFoundFilenames(config, replaceLine, size);
        };
        config.forEach(function (e) {
            _this.addCommand({
                id: e.id,
                name: e.name,
                callback: function () { return initExpander(e); },
                hotkeys: []
            });
        });
    };
    SearchPP.prototype.onunload = function () {
        console.log('unloading plugin');
    };
    return SearchPP;
}(obsidian.Plugin));
var SettingTab = /** @class */ (function (_super) {
    __extends(SettingTab, _super);
    function SettingTab(app, plugin) {
        var _this = _super.call(this, app, plugin) || this;
        _this.app = app;
        _this.plugin = plugin;
        return _this;
    }
    SettingTab.prototype.display = function () {
        var _this = this;
        var containerEl = this.containerEl;
        containerEl.empty();
        containerEl.createEl('h2', { text: 'Settings for Search++' });
        new obsidian.Setting(containerEl)
            .setName('Delay')
            .setDesc('Search++ don\' wait until search completed. It waits for a delay and paste result after that.')
            .addSlider(function (slider) {
            slider.setLimits(1000, 10000, 1000);
            slider.setValue(_this.plugin.delay);
            slider.onChange(function (value) { return _this.plugin.delay = value; });
            slider.setDynamicTooltip();
        });
        new obsidian.Setting(containerEl)
            .setName('Text Extraction')
            .setDesc('Add extracted text to the found results.')
            .addDropdown(function (cb) {
            cb.addOption("Activated", "Activated");
            cb.addOption("Disabled", "Disabled");
            cb.setValue(_this.plugin.textExtraction);
            cb.onChange(function (value) { return _this.plugin.textExtraction = value; });
        });
        new obsidian.Setting(containerEl)
            .setName('Default Size')
            .setDesc('The number of the chars to extract before and after the found text')
            .addText(function (text) {
            text.setValue(_this.plugin.defaultSize.toString());
            text.onChange(function (value) { return _this.plugin.defaultSize = +value; });
        });
    };
    return SettingTab;
}(obsidian.PluginSettingTab));

module.exports = SearchPP;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXMiOlsibm9kZV9tb2R1bGVzL3RzbGliL3RzbGliLmVzNi5qcyIsIm5vZGVfbW9kdWxlcy9yZW1vdmUtbWFya2Rvd24vaW5kZXguanMiLCJtYWluLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG5Db3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi5cclxuXHJcblBlcm1pc3Npb24gdG8gdXNlLCBjb3B5LCBtb2RpZnksIGFuZC9vciBkaXN0cmlidXRlIHRoaXMgc29mdHdhcmUgZm9yIGFueVxyXG5wdXJwb3NlIHdpdGggb3Igd2l0aG91dCBmZWUgaXMgaGVyZWJ5IGdyYW50ZWQuXHJcblxyXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiIEFORCBUSEUgQVVUSE9SIERJU0NMQUlNUyBBTEwgV0FSUkFOVElFUyBXSVRIXHJcblJFR0FSRCBUTyBUSElTIFNPRlRXQVJFIElOQ0xVRElORyBBTEwgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWVxyXG5BTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsXHJcbklORElSRUNULCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgT1IgQU5ZIERBTUFHRVMgV0hBVFNPRVZFUiBSRVNVTFRJTkcgRlJPTVxyXG5MT1NTIE9GIFVTRSwgREFUQSBPUiBQUk9GSVRTLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgTkVHTElHRU5DRSBPUlxyXG5PVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SXHJcblBFUkZPUk1BTkNFIE9GIFRISVMgU09GVFdBUkUuXHJcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovXHJcbi8qIGdsb2JhbCBSZWZsZWN0LCBQcm9taXNlICovXHJcblxyXG52YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uKGQsIGIpIHtcclxuICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcclxuICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGIsIHApKSBkW3BdID0gYltwXTsgfTtcclxuICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZXh0ZW5kcyhkLCBiKSB7XHJcbiAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbn1cclxuXHJcbmV4cG9ydCB2YXIgX19hc3NpZ24gPSBmdW5jdGlvbigpIHtcclxuICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiBfX2Fzc2lnbih0KSB7XHJcbiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07XHJcbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSkgdFtwXSA9IHNbcF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3Jlc3QocywgZSkge1xyXG4gICAgdmFyIHQgPSB7fTtcclxuICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSAmJiBlLmluZGV4T2YocCkgPCAwKVxyXG4gICAgICAgIHRbcF0gPSBzW3BdO1xyXG4gICAgaWYgKHMgIT0gbnVsbCAmJiB0eXBlb2YgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyA9PT0gXCJmdW5jdGlvblwiKVxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBwID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhzKTsgaSA8IHAubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKGUuaW5kZXhPZihwW2ldKSA8IDAgJiYgT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHMsIHBbaV0pKVxyXG4gICAgICAgICAgICAgICAgdFtwW2ldXSA9IHNbcFtpXV07XHJcbiAgICAgICAgfVxyXG4gICAgcmV0dXJuIHQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2RlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XHJcbiAgICB2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGgsIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLCBkO1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcclxuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XHJcbiAgICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19wYXJhbShwYXJhbUluZGV4LCBkZWNvcmF0b3IpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBrZXkpIHsgZGVjb3JhdG9yKHRhcmdldCwga2V5LCBwYXJhbUluZGV4KTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19tZXRhZGF0YShtZXRhZGF0YUtleSwgbWV0YWRhdGFWYWx1ZSkge1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0Lm1ldGFkYXRhID09PSBcImZ1bmN0aW9uXCIpIHJldHVybiBSZWZsZWN0Lm1ldGFkYXRhKG1ldGFkYXRhS2V5LCBtZXRhZGF0YVZhbHVlKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXdhaXRlcih0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2dlbmVyYXRvcih0aGlzQXJnLCBib2R5KSB7XHJcbiAgICB2YXIgXyA9IHsgbGFiZWw6IDAsIHNlbnQ6IGZ1bmN0aW9uKCkgeyBpZiAodFswXSAmIDEpIHRocm93IHRbMV07IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnO1xyXG4gICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksIFwidGhyb3dcIjogdmVyYigxKSwgXCJyZXR1cm5cIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHtcclxuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XHJcbiAgICAgICAgd2hpbGUgKF8pIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IG9wWzBdICYgMiA/IHlbXCJyZXR1cm5cIl0gOiBvcFswXSA/IHlbXCJ0aHJvd1wiXSB8fCAoKHQgPSB5W1wicmV0dXJuXCJdKSAmJiB0LmNhbGwoeSksIDApIDogeS5uZXh0KSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDtcclxuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTtcclxuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cclxuICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHZhciBfX2NyZWF0ZUJpbmRpbmcgPSBPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XHJcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xyXG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xyXG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcclxuICAgIG9bazJdID0gbVtrXTtcclxufSk7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19leHBvcnRTdGFyKG0sIG8pIHtcclxuICAgIGZvciAodmFyIHAgaW4gbSkgaWYgKHAgIT09IFwiZGVmYXVsdFwiICYmICFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobywgcCkpIF9fY3JlYXRlQmluZGluZyhvLCBtLCBwKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fdmFsdWVzKG8pIHtcclxuICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7XHJcbiAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTtcclxuICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gXCJudW1iZXJcIikgcmV0dXJuIHtcclxuICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7XHJcbiAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gXCJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLlwiIDogXCJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19yZWFkKG8sIG4pIHtcclxuICAgIHZhciBtID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9bU3ltYm9sLml0ZXJhdG9yXTtcclxuICAgIGlmICghbSkgcmV0dXJuIG87XHJcbiAgICB2YXIgaSA9IG0uY2FsbChvKSwgciwgYXIgPSBbXSwgZTtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgd2hpbGUgKChuID09PSB2b2lkIDAgfHwgbi0tID4gMCkgJiYgIShyID0gaS5uZXh0KCkpLmRvbmUpIGFyLnB1c2goci52YWx1ZSk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZXJyb3IpIHsgZSA9IHsgZXJyb3I6IGVycm9yIH07IH1cclxuICAgIGZpbmFsbHkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChyICYmICFyLmRvbmUgJiYgKG0gPSBpW1wicmV0dXJuXCJdKSkgbS5jYWxsKGkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmaW5hbGx5IHsgaWYgKGUpIHRocm93IGUuZXJyb3I7IH1cclxuICAgIH1cclxuICAgIHJldHVybiBhcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fc3ByZWFkKCkge1xyXG4gICAgZm9yICh2YXIgYXIgPSBbXSwgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgYXIgPSBhci5jb25jYXQoX19yZWFkKGFyZ3VtZW50c1tpXSkpO1xyXG4gICAgcmV0dXJuIGFyO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19zcHJlYWRBcnJheXMoKSB7XHJcbiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcclxuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcclxuICAgICAgICBmb3IgKHZhciBhID0gYXJndW1lbnRzW2ldLCBqID0gMCwgamwgPSBhLmxlbmd0aDsgaiA8IGpsOyBqKyssIGsrKylcclxuICAgICAgICAgICAgcltrXSA9IGFbal07XHJcbiAgICByZXR1cm4gcjtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2F3YWl0KHYpIHtcclxuICAgIHJldHVybiB0aGlzIGluc3RhbmNlb2YgX19hd2FpdCA/ICh0aGlzLnYgPSB2LCB0aGlzKSA6IG5ldyBfX2F3YWl0KHYpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY0dlbmVyYXRvcih0aGlzQXJnLCBfYXJndW1lbnRzLCBnZW5lcmF0b3IpIHtcclxuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XHJcbiAgICB2YXIgZyA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSwgaSwgcSA9IFtdO1xyXG4gICAgcmV0dXJuIGkgPSB7fSwgdmVyYihcIm5leHRcIiksIHZlcmIoXCJ0aHJvd1wiKSwgdmVyYihcInJldHVyblwiKSwgaVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9LCBpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlmIChnW25dKSBpW25dID0gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChhLCBiKSB7IHEucHVzaChbbiwgdiwgYSwgYl0pID4gMSB8fCByZXN1bWUobiwgdik7IH0pOyB9OyB9XHJcbiAgICBmdW5jdGlvbiByZXN1bWUobiwgdikgeyB0cnkgeyBzdGVwKGdbbl0odikpOyB9IGNhdGNoIChlKSB7IHNldHRsZShxWzBdWzNdLCBlKTsgfSB9XHJcbiAgICBmdW5jdGlvbiBzdGVwKHIpIHsgci52YWx1ZSBpbnN0YW5jZW9mIF9fYXdhaXQgPyBQcm9taXNlLnJlc29sdmUoci52YWx1ZS52KS50aGVuKGZ1bGZpbGwsIHJlamVjdCkgOiBzZXR0bGUocVswXVsyXSwgcik7IH1cclxuICAgIGZ1bmN0aW9uIGZ1bGZpbGwodmFsdWUpIHsgcmVzdW1lKFwibmV4dFwiLCB2YWx1ZSk7IH1cclxuICAgIGZ1bmN0aW9uIHJlamVjdCh2YWx1ZSkgeyByZXN1bWUoXCJ0aHJvd1wiLCB2YWx1ZSk7IH1cclxuICAgIGZ1bmN0aW9uIHNldHRsZShmLCB2KSB7IGlmIChmKHYpLCBxLnNoaWZ0KCksIHEubGVuZ3RoKSByZXN1bWUocVswXVswXSwgcVswXVsxXSk7IH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXN5bmNEZWxlZ2F0b3Iobykge1xyXG4gICAgdmFyIGksIHA7XHJcbiAgICByZXR1cm4gaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIsIGZ1bmN0aW9uIChlKSB7IHRocm93IGU7IH0pLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9LCBpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuLCBmKSB7IGlbbl0gPSBvW25dID8gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIChwID0gIXApID8geyB2YWx1ZTogX19hd2FpdChvW25dKHYpKSwgZG9uZTogbiA9PT0gXCJyZXR1cm5cIiB9IDogZiA/IGYodikgOiB2OyB9IDogZjsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY1ZhbHVlcyhvKSB7XHJcbiAgICBpZiAoIVN5bWJvbC5hc3luY0l0ZXJhdG9yKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3ltYm9sLmFzeW5jSXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xyXG4gICAgdmFyIG0gPSBvW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSwgaTtcclxuICAgIHJldHVybiBtID8gbS5jYWxsKG8pIDogKG8gPSB0eXBlb2YgX192YWx1ZXMgPT09IFwiZnVuY3Rpb25cIiA/IF9fdmFsdWVzKG8pIDogb1tTeW1ib2wuaXRlcmF0b3JdKCksIGkgPSB7fSwgdmVyYihcIm5leHRcIiksIHZlcmIoXCJ0aHJvd1wiKSwgdmVyYihcInJldHVyblwiKSwgaVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9LCBpKTtcclxuICAgIGZ1bmN0aW9uIHZlcmIobikgeyBpW25dID0gb1tuXSAmJiBmdW5jdGlvbiAodikgeyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgeyB2ID0gb1tuXSh2KSwgc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgdi5kb25lLCB2LnZhbHVlKTsgfSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHNldHRsZShyZXNvbHZlLCByZWplY3QsIGQsIHYpIHsgUHJvbWlzZS5yZXNvbHZlKHYpLnRoZW4oZnVuY3Rpb24odikgeyByZXNvbHZlKHsgdmFsdWU6IHYsIGRvbmU6IGQgfSk7IH0sIHJlamVjdCk7IH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fbWFrZVRlbXBsYXRlT2JqZWN0KGNvb2tlZCwgcmF3KSB7XHJcbiAgICBpZiAoT2JqZWN0LmRlZmluZVByb3BlcnR5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjb29rZWQsIFwicmF3XCIsIHsgdmFsdWU6IHJhdyB9KTsgfSBlbHNlIHsgY29va2VkLnJhdyA9IHJhdzsgfVxyXG4gICAgcmV0dXJuIGNvb2tlZDtcclxufTtcclxuXHJcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSBPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcclxufSkgOiBmdW5jdGlvbihvLCB2KSB7XHJcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19pbXBvcnRTdGFyKG1vZCkge1xyXG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcclxuICAgIHZhciByZXN1bHQgPSB7fTtcclxuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcclxuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19pbXBvcnREZWZhdWx0KG1vZCkge1xyXG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBkZWZhdWx0OiBtb2QgfTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fY2xhc3NQcml2YXRlRmllbGRHZXQocmVjZWl2ZXIsIHByaXZhdGVNYXApIHtcclxuICAgIGlmICghcHJpdmF0ZU1hcC5oYXMocmVjZWl2ZXIpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcImF0dGVtcHRlZCB0byBnZXQgcHJpdmF0ZSBmaWVsZCBvbiBub24taW5zdGFuY2VcIik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcHJpdmF0ZU1hcC5nZXQocmVjZWl2ZXIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZFNldChyZWNlaXZlciwgcHJpdmF0ZU1hcCwgdmFsdWUpIHtcclxuICAgIGlmICghcHJpdmF0ZU1hcC5oYXMocmVjZWl2ZXIpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcImF0dGVtcHRlZCB0byBzZXQgcHJpdmF0ZSBmaWVsZCBvbiBub24taW5zdGFuY2VcIik7XHJcbiAgICB9XHJcbiAgICBwcml2YXRlTWFwLnNldChyZWNlaXZlciwgdmFsdWUpO1xyXG4gICAgcmV0dXJuIHZhbHVlO1xyXG59XHJcbiIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24obWQsIG9wdGlvbnMpIHtcbiAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gIG9wdGlvbnMubGlzdFVuaWNvZGVDaGFyID0gb3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSgnbGlzdFVuaWNvZGVDaGFyJykgPyBvcHRpb25zLmxpc3RVbmljb2RlQ2hhciA6IGZhbHNlO1xuICBvcHRpb25zLnN0cmlwTGlzdExlYWRlcnMgPSBvcHRpb25zLmhhc093blByb3BlcnR5KCdzdHJpcExpc3RMZWFkZXJzJykgPyBvcHRpb25zLnN0cmlwTGlzdExlYWRlcnMgOiB0cnVlO1xuICBvcHRpb25zLmdmbSA9IG9wdGlvbnMuaGFzT3duUHJvcGVydHkoJ2dmbScpID8gb3B0aW9ucy5nZm0gOiB0cnVlO1xuICBvcHRpb25zLnVzZUltZ0FsdFRleHQgPSBvcHRpb25zLmhhc093blByb3BlcnR5KCd1c2VJbWdBbHRUZXh0JykgPyBvcHRpb25zLnVzZUltZ0FsdFRleHQgOiB0cnVlO1xuXG4gIHZhciBvdXRwdXQgPSBtZCB8fCAnJztcblxuICAvLyBSZW1vdmUgaG9yaXpvbnRhbCBydWxlcyAoc3RyaXBMaXN0SGVhZGVycyBjb25mbGljdCB3aXRoIHRoaXMgcnVsZSwgd2hpY2ggaXMgd2h5IGl0IGhhcyBiZWVuIG1vdmVkIHRvIHRoZSB0b3ApXG4gIG91dHB1dCA9IG91dHB1dC5yZXBsYWNlKC9eKC1cXHMqP3xcXCpcXHMqP3xfXFxzKj8pezMsfVxccyokL2dtLCAnJyk7XG5cbiAgdHJ5IHtcbiAgICBpZiAob3B0aW9ucy5zdHJpcExpc3RMZWFkZXJzKSB7XG4gICAgICBpZiAob3B0aW9ucy5saXN0VW5pY29kZUNoYXIpXG4gICAgICAgIG91dHB1dCA9IG91dHB1dC5yZXBsYWNlKC9eKFtcXHNcXHRdKikoW1xcKlxcLVxcK118XFxkK1xcLilcXHMrL2dtLCBvcHRpb25zLmxpc3RVbmljb2RlQ2hhciArICcgJDEnKTtcbiAgICAgIGVsc2VcbiAgICAgICAgb3V0cHV0ID0gb3V0cHV0LnJlcGxhY2UoL14oW1xcc1xcdF0qKShbXFwqXFwtXFwrXXxcXGQrXFwuKVxccysvZ20sICckMScpO1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5nZm0pIHtcbiAgICAgIG91dHB1dCA9IG91dHB1dFxuICAgICAgICAvLyBIZWFkZXJcbiAgICAgICAgLnJlcGxhY2UoL1xcbj17Mix9L2csICdcXG4nKVxuICAgICAgICAvLyBGZW5jZWQgY29kZWJsb2Nrc1xuICAgICAgICAucmVwbGFjZSgvfnszfS4qXFxuL2csICcnKVxuICAgICAgICAvLyBTdHJpa2V0aHJvdWdoXG4gICAgICAgIC5yZXBsYWNlKC9+fi9nLCAnJylcbiAgICAgICAgLy8gRmVuY2VkIGNvZGVibG9ja3NcbiAgICAgICAgLnJlcGxhY2UoL2B7M30uKlxcbi9nLCAnJyk7XG4gICAgfVxuICAgIG91dHB1dCA9IG91dHB1dFxuICAgICAgLy8gUmVtb3ZlIEhUTUwgdGFnc1xuICAgICAgLnJlcGxhY2UoLzxbXj5dKj4vZywgJycpXG4gICAgICAvLyBSZW1vdmUgc2V0ZXh0LXN0eWxlIGhlYWRlcnNcbiAgICAgIC5yZXBsYWNlKC9eWz1cXC1dezIsfVxccyokL2csICcnKVxuICAgICAgLy8gUmVtb3ZlIGZvb3Rub3Rlcz9cbiAgICAgIC5yZXBsYWNlKC9cXFtcXF4uKz9cXF0oXFw6IC4qPyQpPy9nLCAnJylcbiAgICAgIC5yZXBsYWNlKC9cXHN7MCwyfVxcWy4qP1xcXTogLio/JC9nLCAnJylcbiAgICAgIC8vIFJlbW92ZSBpbWFnZXNcbiAgICAgIC5yZXBsYWNlKC9cXCFcXFsoLio/KVxcXVtcXFtcXChdLio/W1xcXVxcKV0vZywgb3B0aW9ucy51c2VJbWdBbHRUZXh0ID8gJyQxJyA6ICcnKVxuICAgICAgLy8gUmVtb3ZlIGlubGluZSBsaW5rc1xuICAgICAgLnJlcGxhY2UoL1xcWyguKj8pXFxdW1xcW1xcKF0uKj9bXFxdXFwpXS9nLCAnJDEnKVxuICAgICAgLy8gUmVtb3ZlIGJsb2NrcXVvdGVzXG4gICAgICAucmVwbGFjZSgvXlxcc3swLDN9Plxccz8vZywgJycpXG4gICAgICAvLyBSZW1vdmUgcmVmZXJlbmNlLXN0eWxlIGxpbmtzP1xuICAgICAgLnJlcGxhY2UoL15cXHN7MSwyfVxcWyguKj8pXFxdOiAoXFxTKykoIFwiLio/XCIpP1xccyokL2csICcnKVxuICAgICAgLy8gUmVtb3ZlIGF0eC1zdHlsZSBoZWFkZXJzXG4gICAgICAucmVwbGFjZSgvXihcXG4pP1xcc3swLH0jezEsNn1cXHMrfCB7MCx9KFxcbik/XFxzezAsfSN7MCx9IHswLH0oXFxuKT9cXHN7MCx9JC9nbSwgJyQxJDIkMycpXG4gICAgICAvLyBSZW1vdmUgZW1waGFzaXMgKHJlcGVhdCB0aGUgbGluZSB0byByZW1vdmUgZG91YmxlIGVtcGhhc2lzKVxuICAgICAgLnJlcGxhY2UoLyhbXFwqX117MSwzfSkoXFxTLio/XFxTezAsMX0pXFwxL2csICckMicpXG4gICAgICAucmVwbGFjZSgvKFtcXCpfXXsxLDN9KShcXFMuKj9cXFN7MCwxfSlcXDEvZywgJyQyJylcbiAgICAgIC8vIFJlbW92ZSBjb2RlIGJsb2Nrc1xuICAgICAgLnJlcGxhY2UoLyhgezMsfSkoLio/KVxcMS9nbSwgJyQyJylcbiAgICAgIC8vIFJlbW92ZSBpbmxpbmUgY29kZVxuICAgICAgLnJlcGxhY2UoL2AoLis/KWAvZywgJyQxJylcbiAgICAgIC8vIFJlcGxhY2UgdHdvIG9yIG1vcmUgbmV3bGluZXMgd2l0aCBleGFjdGx5IHR3bz8gTm90IGVudGlyZWx5IHN1cmUgdGhpcyBiZWxvbmdzIGhlcmUuLi5cbiAgICAgIC5yZXBsYWNlKC9cXG57Mix9L2csICdcXG5cXG4nKTtcbiAgfSBjYXRjaChlKSB7XG4gICAgY29uc29sZS5lcnJvcihlKTtcbiAgICByZXR1cm4gbWQ7XG4gIH1cbiAgcmV0dXJuIG91dHB1dDtcbn07XG4iLCJpbXBvcnQge0FwcCwgVmlldywgUGx1Z2luLCBQbHVnaW5TZXR0aW5nVGFiLCBTZXR0aW5nLCBURmlsZSwgRmlsZVZpZXcsIE1hcmtkb3duVmlld30gZnJvbSAnb2JzaWRpYW4nO1xyXG5pbXBvcnQgcmVtb3ZlTWQgZnJvbSBcInJlbW92ZS1tYXJrZG93blwiO1xyXG5cclxuXHJcbmludGVyZmFjZSBDb25maWcge1xyXG4gICAgaWQ6IHN0cmluZztcclxuICAgIG5hbWU6IHN0cmluZztcclxuICAgIGZvcm1hdFRpdGxlOiAoZTogYW55KSA9PiBzdHJpbmc7XHJcbiAgICBmb3JtYXRSZXN1bHRzOiAoc3RyOiBzdHJpbmcsc3RhcnQ6bnVtYmVyLGVuZDpudW1iZXIpID0+IHN0cmluZztcclxuICAgIGZvcm1hdENvbnRlbnQ6IChzdHI6IHN0cmluZyxzdGFydDpudW1iZXIsZW5kOm51bWJlcikgPT4gc3RyaW5nO1xyXG4gICAgcG9zdFJlc3VsdHM6ICgpPT52b2lkO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgRmlsZXMge1xyXG4gICAgZmlsZTogVEZpbGVcclxufVxyXG5cclxuZnVuY3Rpb24gaW5saW5lTG9nKHN0cjogc3RyaW5nKSB7XHJcbiAgICBjb25zb2xlLmxvZyhzdHIpXHJcbiAgICByZXR1cm4gc3RyXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlYXJjaFBQIGV4dGVuZHMgUGx1Z2luIHtcclxuICAgIGRlbGF5ID0gMjAwMDtcclxuICAgIHRleHRFeHRyYWN0aW9uPSBcIkFjdGl2YXRlZFwiO1xyXG4gICAgZGVmYXVsdFNpemU9MzA7XHJcbiAgICBvbmxvYWQoKSB7XHJcbiAgICAgICAgdGhpcy5hZGRTZXR0aW5nVGFiKG5ldyBTZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzKSk7XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdMb2FkaW5nIGluc2VydCBzZWFyY2ggcmVzdWx0cyBwbHVnaW4nKTtcclxuICAgICAgICBjb25zdCBjb25maWc6IENvbmZpZ1tdID0gW1xyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZDogJ2VkaXRvcjppbnNlcnRTZWFyY2hSZXN1bHRzRm9ybWF0ZWQnLFxyXG4gICAgICAgICAgICAgICAgbmFtZTogJ0luc2VydCBzZWFyY2ggcmVzdWx0cyBGb3JtYXRlZCcsXHJcbiAgICAgICAgICAgICAgICBmb3JtYXRUaXRsZTogZWxlID0+ICBcIiMgXCIrZWxlLmZpbGUubmFtZStcIiAoXCIrZWxlLnJlc3VsdC5jb250ZW50Lmxlbmd0aCtcIilcIitcIlxcblwiK1wiW1tcIiArIGVsZS5maWxlLm5hbWUgKyBcIl1dXCIrXCJcXG5cIixcclxuICAgICAgICAgICAgICAgIGZvcm1hdFJlc3VsdHM6KHN0cixzdGFydCxlbmQpID0+IFwiIyMgLi4uXCIrcmVtb3ZlTWQoc3RyLnN1YnN0cmluZyhzdGFydCxlbmQpLnJlcGxhY2UoXCJcXG5cIixcIiBcIikpK1wiLi4uXFxuXCIsXHJcbiAgICAgICAgICAgICAgICBmb3JtYXRDb250ZW50OihzdHIsc3RhcnQsZW5kKSA9PiByZW1vdmVNZChzdHIuc3Vic3RyaW5nKHN0YXJ0LGVuZCkucmVwbGFjZShcIlxcblwiLFwiIFwiKSksXHJcbiAgICAgICAgICAgICAgICBwb3N0UmVzdWx0czooKT0+e3RoaXMuYXBwLmNvbW1hbmRzLmNvbW1hbmRzW1wiZWRpdG9yOmZvbGQtYWxsXCJdLmNoZWNrQ2FsbGJhY2soKTt9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlkOiAnZWRpdG9yOmluc2VydFNlYXJjaFJlc3VsdHNOb3RGb3JtYXRlZCcsXHJcbiAgICAgICAgICAgICAgICBuYW1lOiAnSW5zZXJ0IHNlYXJjaCByZXN1bHRzIG5vdCBmb3JtYXRlZCcsXHJcbiAgICAgICAgICAgICAgICBmb3JtYXRUaXRsZTogZWxlID0+ICBlbGUuZmlsZS5uYW1lK1wiIChcIitlbGUucmVzdWx0LmNvbnRlbnQubGVuZ3RoK1wiKVwiK1wiXFxuXCIrXCJbW1wiICsgZWxlLmZpbGUubmFtZSArIFwiXV1cIitcIlxcblwiLFxyXG4gICAgICAgICAgICAgICAgZm9ybWF0UmVzdWx0czooc3RyLHN0YXJ0LGVuZCkgPT4gcmVtb3ZlTWQoc3RyLnN1YnN0cmluZyhzdGFydCxlbmQpLnJlcGxhY2UoXCJcXG5cIixcIiBcIikpK1wiLi4uXFxuXCIsXHJcbiAgICAgICAgICAgICAgICBmb3JtYXRDb250ZW50OihzdHIsc3RhcnQsZW5kKSA9PiByZW1vdmVNZChzdHIuc3Vic3RyaW5nKHN0YXJ0LGVuZCkucmVwbGFjZShcIlxcblwiLFwiIFwiKSksXHJcbiAgICAgICAgICAgICAgICBwb3N0UmVzdWx0czooKT0+e31cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWQ6ICdlZGl0b3I6aW5zZXJ0U2VhcmNoUmVzdWx0Q29udGVudCcsXHJcbiAgICAgICAgICAgICAgICBuYW1lOiAnSW5zZXJ0IHNlYXJjaCByZXN1bHRzIGNvbnRlbnQnLFxyXG4gICAgICAgICAgICAgICAgZm9ybWF0VGl0bGU6IGVsZSA9PiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgZm9ybWF0UmVzdWx0czooc3RyLHN0YXJ0LGVuZCkgPT4gXCJcIixcclxuICAgICAgICAgICAgICAgIGZvcm1hdENvbnRlbnQ6KHN0cixzdGFydCxlbmQpID0+IHJlbW92ZU1kKHN0ci5zdWJzdHJpbmcoc3RhcnQsZW5kKS5yZXBsYWNlKFwiXFxuXCIsXCIgXCIpKSxcclxuICAgICAgICAgICAgICAgIHBvc3RSZXN1bHRzOigpPT57fVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIF1cclxuXHJcbiAgICAgICAgY29uc3QgcmVmb3JtYXRMaW5rcyA9IChsaW5rczogRmlsZXNbXSwgY29uZmlnOkNvbmZpZyxzaXplOm51bWJlcik6IHN0cmluZyA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRWaWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmFjdGl2ZUxlYWYudmlld1xyXG4gICAgICAgICAgICBjb25zdCBxdWVyeTpzdHJpbmc9ICB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhdmVzT2ZUeXBlKCdzZWFyY2gnKVswXS52aWV3LnNlYXJjaFF1ZXJ5LnF1ZXJ5LnJlcGxhY2UoL15cIiguKilcIiQvLCAnJDEnKTtcclxuICAgICAgICAgICAgbGlua3Muc29ydCgoYSxiKT0+Yi5yZXN1bHQuY29udGVudC5sZW5ndGgtYS5yZXN1bHQuY29udGVudC5sZW5ndGgpO1xyXG4gICAgICAgICAgICByZXR1cm4gbGlua3MuZmlsdGVyKGVsZT0+ZWxlLmZpbGUubmFtZSE9PWN1cnJlbnRWaWV3LmZpbGUubmFtZSkubWFwKChlbGUpPT57XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgdGl0bGVTaXplPTIwO1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBleHRyYWN0ZWRUZXh0PVwiXCI7XHJcbiAgICAgICAgICAgICAgIGlmKHRoaXMudGV4dEV4dHJhY3Rpb249PVwiQWN0aXZhdGVkXCIpe1xyXG4gICAgICAgICAgICAgICAgICAgIGV4dHJhY3RlZFRleHQgPSBjb25maWcuZm9ybWF0VGl0bGUoZWxlKTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgbWluSW5kZXg9IDk5OTk5OTk7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IG1heEluZGV4PSAwO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgZWxlLnJlc3VsdC5jb250ZW50LmZvckVhY2gocG9zaXRpb24gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtaW5UaXRsZTpudW1iZXI9TWF0aC5tYXgocG9zaXRpb25bMF0tdGl0bGVTaXplLDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXhUaXRsZTpudW1iZXI9TWF0aC5taW4ocG9zaXRpb25bMV0rdGl0bGVTaXplLGVsZS5jb250ZW50Lmxlbmd0aC0xKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbWluOm51bWJlcj1NYXRoLm1heChwb3NpdGlvblswXS1zaXplLDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXg6bnVtYmVyPU1hdGgubWluKHBvc2l0aW9uWzFdK3NpemUsZWxlLmNvbnRlbnQubGVuZ3RoLTEpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyh7bWluLG1heCxtaW5JbmRleCxtYXhJbmRleH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgaWYoISgobWluPj1taW5JbmRleCAmJiBtaW4gPD0gbWF4SW5kZXgpIHx8IChtYXg+PW1pbkluZGV4ICYmIG1heCA8PSBtYXhJbmRleCkpKXsgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1pbkluZGV4PU1hdGgubWluKG1pbkluZGV4LHBvc2l0aW9uWzBdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4SW5kZXg9TWF0aC5tYXgobWF4SW5kZXgscG9zaXRpb25bMV0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZXh0cmFjdGVkVGV4dCs9Y29uZmlnLmZvcm1hdFJlc3VsdHMoZWxlLmNvbnRlbnQsbWluVGl0bGUsbWF4VGl0bGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGVsZS5jb250ZW50LnN1YnN0cmluZyhtaW4sbWF4KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhY3RlZFRleHQrPWNvbmZpZy5mb3JtYXRDb250ZW50KGVsZS5jb250ZW50LG1pbixtYXgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBleHRyYWN0ZWRUZXh0O1xyXG4gICAgICAgICAgICB9KS5qb2luKCdcXG4nKVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRMYXN0TGluZU51bShkb2M6IENvZGVNaXJyb3IuRG9jLCBsaW5lID0gMCk6IG51bWJlciB7XHJcbiAgICAgICAgICAgIGNvbnN0IGxpbmVOdW0gPSBsaW5lID09PSAwXHJcbiAgICAgICAgICAgICAgICA/IGRvYy5nZXRDdXJzb3IoKS5saW5lXHJcbiAgICAgICAgICAgICAgICA6IGxpbmVcclxuXHJcbiAgICAgICAgICAgIGlmIChkb2MubGluZUNvdW50KCkgPT09IGxpbmVOdW0pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkb2MuZ2V0Q3Vyc29yKCkubGluZSArIDFcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRvYy5nZXRMaW5lKGxpbmVOdW0pID09PSAnLS0tJ1xyXG4gICAgICAgICAgICAgICAgPyBsaW5lTnVtXHJcbiAgICAgICAgICAgICAgICA6IGdldExhc3RMaW5lTnVtKGRvYywgbGluZU51bSArIDEpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBpbml0RXhwYW5kZXIgPSAoY29uZmlnOkNvbmZpZyk9PiB7XHJcbiAgICAgICAgICAgIC8vIFNlYXJjaCBmaWxlc1xyXG4gICAgICAgICAgICBsZXQgY21Eb2MgPSBudWxsIGFzIENvZGVNaXJyb3IuRG9jIHx8IG51bGxcclxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICBjb25zdCBnbG9iYWxTZWFyY2hGbiA9IHRoaXMuYXBwLmludGVybmFsUGx1Z2lucy5nZXRQbHVnaW5CeUlkKCdnbG9iYWwtc2VhcmNoJykuaW5zdGFuY2Uub3Blbkdsb2JhbFNlYXJjaC5iaW5kKHRoaXMpXHJcblxyXG5cclxuICAgICAgICAgICAgY29uc3Qgc2VhcmNoID0gKHF1ZXJ5OiBzdHJpbmcpID0+IGdsb2JhbFNlYXJjaEZuKGlubGluZUxvZyhxdWVyeSkpXHJcblxyXG4gICAgICAgICAgICBjb25zdCBnZXRGb3VuZEZpbGVuYW1lcyA9IChjb25maWc6Q29uZmlnLCBjYWxsYmFjazogKHM6IHN0cmluZykgPT4gYW55LHNpemU6bnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzZWFyY2hMZWFmID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYXZlc09mVHlwZSgnc2VhcmNoJylbMF1cclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwic2VhcmNoTGVhZlwiLHNlYXJjaExlYWYpO1xyXG4gICAgICAgICAgICAgICAgc2VhcmNoTGVhZi5vcGVuKHNlYXJjaExlYWYudmlldylcclxuICAgICAgICAgICAgICAgICAgICAudGhlbigodmlldzogVmlldykgPT4gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVzaW5nIHVuZG9jdW1lbnRlZCBmZWF0dXJlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gcmVmb3JtYXRMaW5rcyh2aWV3LmRvbS5yZXN1bHREb21zLCBjb25maWcsc2l6ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2socmVzdWx0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWcucG9zdFJlc3VsdHMoKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmRlbGF5KSlcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3QgY3VycmVudFZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuYWN0aXZlTGVhZi52aWV3XHJcblxyXG4gICAgICAgICAgICBpZiAoY3VycmVudFZpZXcgaW5zdGFuY2VvZiBNYXJrZG93blZpZXcpIHtcclxuICAgICAgICAgICAgICAgIGNtRG9jID0gY3VycmVudFZpZXcuc291cmNlTW9kZS5jbUVkaXRvclxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBoYXNGb3JtdWxhUmVnZXhwID0gL15cXHtcXHsuK1xcfVxcfS4qL1xyXG4gICAgICAgICAgICBjb25zdCBjdXJOdW0gPSBjbURvYy5nZXRDdXJzb3IoKS5saW5lXHJcbiAgICAgICAgICAgIGNvbnN0IGN1clRleHQgPSBjbURvYy5nZXRMaW5lKGN1ck51bSlcclxuICAgICAgICAgICAgaWYgKCFoYXNGb3JtdWxhUmVnZXhwLnRlc3QoY3VyVGV4dCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IGlzRW1iZWQgPSBjbURvYy5nZXRMaW5lKGN1ck51bSAtIDEpID09PSAnYGBgZXhwYW5kZXInXHJcbiAgICAgICAgICAgICAgICAmJiBjbURvYy5nZXRMaW5lKGN1ck51bSArIDEpID09PSAnYGBgJ1xyXG5cclxuICAgICAgICAgICAgY29uc3QgZnN0TGluZU51bVRvUmVwbGFjZSA9IGlzRW1iZWRcclxuICAgICAgICAgICAgICAgID8gY3VyTnVtIC0gMVxyXG4gICAgICAgICAgICAgICAgOiBjdXJOdW1cclxuICAgICAgICAgICAgY29uc3QgbHN0TGluZU51bVRvUmVwbGFjZSA9IGlzRW1iZWRcclxuICAgICAgICAgICAgICAgID8gZ2V0TGFzdExpbmVOdW0oY21Eb2MpXHJcbiAgICAgICAgICAgICAgICA6IGN1ck51bVxyXG5cclxuICAgICAgICAgICAgbGV0IHNlYXJjaFF1ZXJ5ID0gY3VyVGV4dC5yZXBsYWNlKCd7eycsICcnKS5yZXBsYWNlKCd9fScsICcnKVxyXG4gICAgICAgICAgICBsZXQgc2l6ZSA9IHRoaXMuZGVmYXVsdFNpemU7XHJcbiAgICAgICAgICAgICBpZihzZWFyY2hRdWVyeS5pbmRleE9mKFwiL1wiKSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIHNpemUgPSArc2VhcmNoUXVlcnkuc3BsaXQoXCIvXCIpWzFdO1xyXG4gICAgICAgICAgICAgICAgc2VhcmNoUXVlcnkgPSBzZWFyY2hRdWVyeS5zcGxpdChcIi9cIilbMF07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGVtYmVkRm9ybXVsYSA9ICdgYGBleHBhbmRlclxcbicgK1xyXG4gICAgICAgICAgICAgICAgJ3t7JyArIHNlYXJjaFF1ZXJ5ICsgJ319XFxuJyArXHJcbiAgICAgICAgICAgICAgICAnYGBgXFxuJ1xyXG5cclxuICAgICAgICAgICBjb25zdCByZXBsYWNlTGluZSA9IChjb250ZW50OiBzdHJpbmcpID0+IGNtRG9jLnJlcGxhY2VSYW5nZShlbWJlZEZvcm11bGEgKyBjb250ZW50ICsgJ1xcblxcbicsXHJcbiAgICAgICAgICAgICAgICB7bGluZTogZnN0TGluZU51bVRvUmVwbGFjZSwgY2g6IDB9LFxyXG4gICAgICAgICAgICAgICAge2xpbmU6IGxzdExpbmVOdW1Ub1JlcGxhY2UsIGNoOiBjbURvYy5nZXRMaW5lKGxzdExpbmVOdW1Ub1JlcGxhY2UpLmxlbmd0aH1cclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgc2VhcmNoKGlubGluZUxvZyhzZWFyY2hRdWVyeSkpO1xyXG4gICAgICAgICAgICBnZXRGb3VuZEZpbGVuYW1lcyhjb25maWcsIHJlcGxhY2VMaW5lLHNpemUpO1xyXG4gICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uZmlnLmZvckVhY2goZSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkQ29tbWFuZCh7XHJcbiAgICAgICAgICAgICAgICBpZDogZS5pZCxcclxuICAgICAgICAgICAgICAgIG5hbWU6IGUubmFtZSxcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrOiAoKSA9PiBpbml0RXhwYW5kZXIoZSksXHJcbiAgICAgICAgICAgICAgICBob3RrZXlzOiBbXVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgb251bmxvYWQoKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ3VubG9hZGluZyBwbHVnaW4nKTtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgU2V0dGluZ1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xyXG4gICAgcGx1Z2luOiBTZWFyY2hQUFxyXG5cclxuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IFNlYXJjaFBQKSB7XHJcbiAgICAgICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xyXG5cclxuICAgICAgICB0aGlzLmFwcCA9IGFwcFxyXG4gICAgICAgIHRoaXMucGx1Z2luID0gcGx1Z2luXHJcbiAgICB9XHJcblxyXG4gICAgZGlzcGxheSgpOiB2b2lkIHtcclxuICAgICAgICBsZXQge2NvbnRhaW5lckVsfSA9IHRoaXM7XHJcblxyXG4gICAgICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7XHJcblxyXG4gICAgICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoMicsIHt0ZXh0OiAnU2V0dGluZ3MgZm9yIFNlYXJjaCsrJ30pO1xyXG5cclxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgICAgICAgLnNldE5hbWUoJ0RlbGF5JylcclxuICAgICAgICAgICAgLnNldERlc2MoJ1NlYXJjaCsrIGRvblxcJyB3YWl0IHVudGlsIHNlYXJjaCBjb21wbGV0ZWQuIEl0IHdhaXRzIGZvciBhIGRlbGF5IGFuZCBwYXN0ZSByZXN1bHQgYWZ0ZXIgdGhhdC4nKVxyXG4gICAgICAgICAgICAuYWRkU2xpZGVyKHNsaWRlciA9PiB7XHJcbiAgICAgICAgICAgICAgICBzbGlkZXIuc2V0TGltaXRzKDEwMDAsIDEwMDAwLCAxMDAwKVxyXG4gICAgICAgICAgICAgICAgc2xpZGVyLnNldFZhbHVlKHRoaXMucGx1Z2luLmRlbGF5KVxyXG4gICAgICAgICAgICAgICAgc2xpZGVyLm9uQ2hhbmdlKHZhbHVlID0+IHRoaXMucGx1Z2luLmRlbGF5ID0gdmFsdWUpXHJcbiAgICAgICAgICAgICAgICBzbGlkZXIuc2V0RHluYW1pY1Rvb2x0aXAoKVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIFxyXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAgICAgICAuc2V0TmFtZSgnVGV4dCBFeHRyYWN0aW9uJylcclxuICAgICAgICAgICAgLnNldERlc2MoJ0FkZCBleHRyYWN0ZWQgdGV4dCB0byB0aGUgZm91bmQgcmVzdWx0cy4nKVxyXG4gICAgICAgICAgICAuYWRkRHJvcGRvd24oKGNiKT0+e1xyXG4gICAgICAgICAgICAgICAgY2IuYWRkT3B0aW9uKFwiQWN0aXZhdGVkXCIsXCJBY3RpdmF0ZWRcIik7XHJcbiAgICAgICAgICAgICAgICBjYi5hZGRPcHRpb24oXCJEaXNhYmxlZFwiLFwiRGlzYWJsZWRcIik7XHJcbiAgICAgICAgICAgICAgICBjYi5zZXRWYWx1ZSh0aGlzLnBsdWdpbi50ZXh0RXh0cmFjdGlvbik7XHJcbiAgICAgICAgICAgICAgICBjYi5vbkNoYW5nZSh2YWx1ZSA9PiB0aGlzLnBsdWdpbi50ZXh0RXh0cmFjdGlvbiA9IHZhbHVlKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICBcclxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgICAgICAgLnNldE5hbWUoJ0RlZmF1bHQgU2l6ZScpXHJcbiAgICAgICAgICAgIC5zZXREZXNjKCdUaGUgbnVtYmVyIG9mIHRoZSBjaGFycyB0byBleHRyYWN0IGJlZm9yZSBhbmQgYWZ0ZXIgdGhlIGZvdW5kIHRleHQnKVxyXG4gICAgICAgICAgICAuYWRkVGV4dCgodGV4dCk9PntcclxuICAgICAgICAgICAgICAgIHRleHQuc2V0VmFsdWUodGhpcy5wbHVnaW4uZGVmYXVsdFNpemUudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgICAgICAgICB0ZXh0Lm9uQ2hhbmdlKHZhbHVlID0+IHRoaXMucGx1Z2luLmRlZmF1bHRTaXplID0gK3ZhbHVlKTtcclxuICAgICAgICAgICAgfSlcclxuICAgIH1cclxufVxyXG4iXSwibmFtZXMiOlsicmVtb3ZlTWQiLCJNYXJrZG93blZpZXciLCJQbHVnaW4iLCJTZXR0aW5nIiwiUGx1Z2luU2V0dGluZ1RhYiJdLCJtYXBwaW5ncyI6Ijs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSSxhQUFhLEdBQUcsU0FBUyxDQUFDLEVBQUUsQ0FBQyxFQUFFO0FBQ25DLElBQUksYUFBYSxHQUFHLE1BQU0sQ0FBQyxjQUFjO0FBQ3pDLFNBQVMsRUFBRSxTQUFTLEVBQUUsRUFBRSxFQUFFLFlBQVksS0FBSyxJQUFJLFVBQVUsQ0FBQyxFQUFFLENBQUMsRUFBRSxF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
